---
date: 2026-02-27
keywords: [MapTRv2, Vectorized Mapping, Online HD-Map, Permutation Invariant, 2024]
tags: [Level-02, Perception-Hardcore, Mapping-SOTA]
---

# MapTRv2-è®ºæ–‡é€Ÿè¯»

## 0. åŸºæœ¬ä¿¡æ¯
- **å‘è¡¨æ—¶é—´**: 2024å¹´ (CVPR 2024 / ICLR 2024)
- **ä½œè€…å•ä½**: ç¾å›¢ (Meituan)ã€æ¸…åå¤§å­¦
- **ä»£ç ä»“åº“**: [https://github.com/hustvl/MapTR](https://github.com/hustvl/MapTR)
- **Tags**: #åœ¨çº¿çŸ¢é‡åŒ–å»ºå›¾ #æ’åˆ—ä¸å˜æ€§å»ºæ¨¡ #ç«¯åˆ°ç«¯æ„ŸçŸ¥ #HD-Map

---

## 1. ğŸ”ª ä»Šæ—¥é”è¯„
> **MapTRv2** è®©â€œæ„ŸçŸ¥å³å»ºå›¾â€å˜å¾—ä¼˜é›…ã€‚
> 
> **æ ¸å¿ƒæ´å¯Ÿ**ï¼šåœ¨å®ƒä¹‹å‰ï¼Œå»ºå›¾æœ€å¤§çš„å‘æ˜¯â€œç‚¹çš„é¡ºåºâ€ã€‚ä¸€æ ¹è½¦é“çº¿ï¼Œä»å·¦å¾€å³æ ‡å’Œä»å³å¾€å·¦æ ‡ï¼Œåœ¨æ•°å­¦ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œä½†æ¨¡å‹å¾ˆéš¾æ”¶æ•›ã€‚MapTRv2 æå‡ºäº† **Permutation-Invariant Modeling (æ’åˆ—ä¸å˜æ€§å»ºæ¨¡)**ï¼Œå½»åº•è§£å†³äº†è¿™ä¸ªè¯­ä¹‰æ­§ä¹‰é—®é¢˜ã€‚å®ƒè¯æ˜äº†ï¼šå»ºå›¾ä¸æ˜¯ç”»çº¿ï¼Œè€Œæ˜¯**ç‚¹é›†çš„é›†åˆè®ºé—®é¢˜**ã€‚

---

## 2. ğŸ—ï¸ æ¨¡å‹æ¶æ„ (Architecture Map)
![MapTRv2 Architecture](https://github.com/hustvl/MapTR/raw/main/figs/maptrv2.png)
*Figure 1: MapTRv2 åˆ†å±‚ Query æ¶æ„ã€‚å±•ç¤ºäº† Instance Queries å’Œ Point Queries çš„åŒå±‚ç»“æ„ã€‚*

### **è¯¦ç»†æ–‡å­—æè¿°ï¼š**
1. **BEV Encoder**: é€šç”¨ BEV æå–å™¨ï¼ˆæ”¯æŒ GBEV/LSSï¼‰ã€‚
2. **Hierarchical Queries (æ ¸å¿ƒ)**: 
   - **Instance Queries**: è´Ÿè´£è¯†åˆ«â€œè¿™é‡Œæœ‰ä¸€æ ¹çº¿â€ã€‚
   - **Point Queries**: è´Ÿè´£ç²¾ç»†åŒ–æè¿°è¿™æ ¹çº¿çš„å‡ ä½•å½¢çŠ¶ã€‚
3. **Map Decoder**: Transformer Decoder å°†ä¸¤å±‚ Query äº¤äº’ï¼Œè¾“å‡ºå¸¦é¡ºåºçš„ç‚¹é›†ã€‚
4. **Matching & Head**: é‡‡ç”¨å±‚æ¬¡åŒ–åŒˆç‰™åˆ©åŒ¹é…ï¼Œå¯»æ‰¾é¢„æµ‹ç‚¹é›†ä¸çœŸå€¼ç‚¹é›†çš„æœ€ä¼˜å¯¹é½ã€‚

---

## 3. ğŸ’¡ æ ¸å¿ƒåˆ›æ–° (Math & Pseudo-code)

### 3.1 æ’åˆ—ä¸å˜æ€§å»ºæ¨¡ (Permutation Invariance)
**é€»è¾‘**ï¼šå®šä¹‰ä¸€ä¸ªç­‰ä»·æ’åˆ—ç»„ $\Gamma$ï¼ŒåŒ…å«åŸå§‹é¡ºåºåŠå…¶é€†åºã€‚è®¡ç®— Loss æ—¶å–ç»„å†…æœ€å°å€¼ã€‚

**PyTorch é£æ ¼ä¼ªä»£ç å®ç°**ï¼š
```python
def compute_permutation_loss(pred_pts, gt_pts):
    # pred_pts: [N, 2] (é¢„æµ‹çš„ç‚¹åºåˆ—)
    # gt_pts: [N, 2] (çœŸå€¼)
    
    # 1. ç”Ÿæˆç­‰ä»·æ’åˆ— (Forward & Reverse)
    gt_pts_forward = gt_pts
    gt_pts_reverse = torch.flip(gt_pts, dims=[0])
    
    # 2. è®¡ç®—ä¸¤ç§é¡ºåºä¸‹çš„ Chamfer/L1 è·ç¦»
    loss_f = F.l1_loss(pred_pts, gt_pts_forward)
    loss_r = F.l1_loss(pred_pts, gt_pts_reverse)
    
    # 3. å–æœ€ä¼˜è§£ (Invariant to order)
    return torch.min(loss_f, loss_r)
```

---

## 5. ğŸ“Š å…³é”®æŒ‡æ ‡ (nuScenes Map)
- **mAP**: åœ¨ Drivable Area, Pedestrian Crossing, Divider ç­‰æ‰€æœ‰åœ°å›¾å…ƒç´ ä¸Šå‡è¾¾åˆ° 2024 å¹´ SOTAã€‚
- **æ•ˆç‡**: é€šè¿‡åˆ†å±‚ Queryï¼Œæ¨¡å‹æ”¶æ•›é€Ÿåº¦æ¯” v1 ç‰ˆæœ¬å¿«äº† **2 å€**ã€‚

---

## 10. ğŸ› ï¸ è½åœ°å»ºè®®
- **çŸ¢é‡åŒ–è¾“å‡º**: å®ƒçš„è¾“å‡ºç›´æ¥å°±æ˜¯å¤šè¾¹å½¢æˆ–æŠ˜çº¿ï¼Œå¯ä»¥ç›´æ¥å–‚ç»™ä¸‹æ¸¸çš„ **PNC (Planning & Control)** æ¨¡å—ä½¿ç”¨ã€‚
- **é²æ£’æ€§**: åœ¨è·¯å£åˆ†å‰å¤„ï¼Œå»ºè®®å¢åŠ è¾…åŠ©çš„ **Connectivity Loss** æå‡æ‹“æ‰‘ç¨³å®šæ€§ã€‚
