# SparseAD-v2: Real-time End-to-End Planning via Sparse Constraints

## 0. åŸºæœ¬ä¿¡æ¯
- **æ—¶é—´**: 2025 (Arxiv/SOTA)
- **ä½œè€…å•ä½**: æ—·è§†ç§‘æŠ€ (Megvii), åœ°å¹³çº¿ (Horizon Robotics)
- **ä¸“ä¸š Tags**: `Sparse Perception`, `Real-time`, `End-to-End Planning`, `Unified Query`

## 1. ğŸ”ª ä»Šæ—¥é”è¯„
**ç‰©ç†ç—›ç‚¹**: æŒ‘æˆ˜â€œå…¨æ ˆå¯†é›†æ„ŸçŸ¥â€çš„ç®—åŠ›ç¥è¯ã€‚SparseAD-v2 è¯æ˜äº†åœ¨ 3D ç©ºé—´ä¸­ï¼Œåªæœ‰ 5% çš„åŒºåŸŸå¯¹å†³ç­–æ˜¯çœŸæ­£å…³é”®çš„ã€‚è§£å†³äº†ç«¯ä¾§è®¾å¤‡ï¼ˆå¦‚ Orin-Xï¼‰è¿è¡Œç«¯åˆ°ç«¯æ¨¡å‹æ—¶çš„ä½å¸§ç‡é—®é¢˜ï¼Œå®ç°äº† 30FPS ä»¥ä¸Šçš„é«˜é¢‘é—­ç¯å“åº”ã€‚

## 2. ğŸ—ï¸ æ¨¡å‹æ¶æ„ (Architecture Map)
- **Sparse Sampling**: æ”¾å¼ƒå…¨å›¾ Cross-Attentionï¼Œä»…åœ¨ $N=900$ ä¸ª Query å¯¹åº”çš„ 3D å‚è€ƒç‚¹å‘¨å›´é‡‡æ ·ç‰¹å¾ã€‚
- **Unified Query Architecture**: åŒä¸€å¥— Query åŒæ—¶è´Ÿè´£æ£€æµ‹ï¼ˆBBoxï¼‰ã€è·Ÿè¸ªï¼ˆIDï¼‰å’Œè§„åˆ’ï¼ˆSelf-motionï¼‰ã€‚
- **Iterative Refinement**: é€šè¿‡ 6 å±‚ Transformer Decoder é€å±‚ä¿®æ­£ Query çš„å‡ ä½•å±æ€§ã€‚

## 3. ğŸ’¡ æ ¸å¿ƒåˆ›æ–° (Math & Pseudo-code)
**ç»Ÿä¸€äº¤äº’è§£ç å™¨ (Unified Interaction Decoder)**:
```python
# PyTorch é£æ ¼ä¼ªä»£ç 
# queries: [B, 900, 256], bev_feats: [B, C, H, W]
def sparse_decoder(queries, bev_feats):
    for layer in self.layers:
        # 1. Dynamic Sampling: [B, 900, 256]
        sampled_feats = self.dynamic_sampler(bev_feats, queries.pos)
        
        # 2. Self-Interaction (Object-to-Object)
        queries = layer.self_attn(queries)
        
        # 3. Task Specific Outputs
        bbox = self.bbox_head(queries) # [B, 900, 9]
        ego_traj = self.plan_head(queries[:, 0, :]) # [B, 6, 2]
    return bbox, ego_traj
```

## 4. ğŸ“‰ Loss å‡½æ•°è¯¦è§£
- **$L_{det}$**: Focal Loss + L1 Loss (BBox)ã€‚
- **$L_{plan}$**: å¤šæ¨¡æ€è½¨è¿¹æŸå¤±ï¼ˆMulti-modal NLLï¼‰ã€‚

## 5. ğŸ“Š å…³é”®æŒ‡æ ‡ (SOTA Compare)
- **L2 Error (Planning)**: 0.65m (vs. UniAD 0.72m)ã€‚
- **FPS (Orin-X)**: 35 FPS (vs. UniAD 2 FPS)ã€‚

## 6. ğŸ“‚ æ•°æ®ç­–ç•¥ä¸é¢„å¤„ç†
- **Point-based Annotation**: ä¼˜åŒ–äº†ç¨€ç–ç‚¹çš„çœŸå€¼åˆ†é…ç­–ç•¥ï¼Œå‡å°‘æ­£è´Ÿæ ·æœ¬ä¸å‡è¡¡ã€‚

## 10. ğŸ› ï¸ è½åœ°å»ºè®® (Deployment)
- **ç®—å­åˆå¹¶**: æ·±åº¦ä¼˜åŒ– `SparseSampling` ç®—å­ï¼Œå»ºè®®ç›´æ¥è°ƒç”¨ TensorRT GridSample æ’ä»¶ã€‚
