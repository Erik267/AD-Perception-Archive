---
date: 2026-02-27
keywords: [VAD-v2, Probabilistic Planning, Generative AD, Action Vocabulary, 2024]
tags: [Level-03, Perception-to-Planning, Generative-AI]
---

# VAD-v2-è®ºæ–‡é€Ÿè¯»

## 0. åŸºæœ¬ä¿¡æ¯
- **å‘è¡¨æ—¶é—´**: 2024å¹´
- **ä½œè€…å•ä½**: åä¸­ç§‘æŠ€å¤§å­¦ã€åœ°å¹³çº¿
- **ä»£ç ä»“åº“**: [https://github.com/hustvl/VAD](https://github.com/hustvl/VAD) (v2 åˆ†æ”¯)
- **Tags**: #æ¦‚ç‡è§„æ§ #ç”Ÿæˆå¼é©±åŠ¨ #ç«¯åˆ°ç«¯å†³ç­– #é•¿å°¾åœºæ™¯çªç ´

---

## 1. ğŸ”ª ä»Šæ—¥é”è¯„
> **VAD-v2** æ˜¯è‡ªåŠ¨é©¾é©¶é¢†åŸŸçš„â€œLLM æ—¶åˆ»â€ã€‚
> 
> **æ ¸å¿ƒæ´å¯Ÿ**ï¼šä¹‹å‰çš„è§„åˆ’æ¨¡å‹éƒ½åœ¨åšè¿ç»­åæ ‡å›å½’ï¼ˆRegressionï¼‰ï¼Œè¿™ä¼šå¯¼è‡´æ¨¡å‹åœ¨è·¯å£åšå¼ˆæ—¶â€œä¸¾æ£‹ä¸å®šâ€ã€‚VAD-v2 å€Ÿé‰´äº† LLM çš„æ€è·¯ï¼Œå°†è§„åˆ’å»ºæ¨¡ä¸º**æ¦‚ç‡åˆ†å¸ƒé¢„æµ‹**ã€‚å®ƒä¸å†åªé¢„æµ‹ä¸€ä¸ª $x, y$ï¼Œè€Œæ˜¯é¢„æµ‹ä¸€å †**åŠ¨ä½œ Token** çš„æ¦‚ç‡ã€‚è¿™è®©å®ƒå…·å¤‡äº†å¤„ç†å¤šæ¨¡æ€æ„å›¾ï¼ˆæ¯”å¦‚ï¼šæ—¢å¯ä»¥å·¦è½¬ä¹Ÿå¯ä»¥ç›´è¡Œï¼‰çš„ç±»äººæ€ç»´èƒ½åŠ›ã€‚

---

## 2. ğŸ—ï¸ æ¨¡å‹æ¶æ„ (Architecture Map)
```mermaid
graph LR
    A[Multi-modal Tokens] --> B[Scene Transformer]
    B --> C[Probabilistic Planning Head]
    C --> D[Action Distribution: P(a|s)]
    D --> E[Sampled Trajectory]
```

### **è¯¦ç»†æ–‡å­—æè¿°ï¼š**
1. **Scene Tokenizer**: å°†åœºæ™¯å†…çš„ Agent, Map, Traffic Light å…¨éƒ¨ Token åŒ–ï¼ˆç±»ä¼¼è¯­è¨€æ¨¡å‹ä¸­çš„å•è¯ï¼‰ã€‚
2. **Action Vocabulary (æ ¸å¿ƒ)**: é¢„è®¾äº†ä¸€ä¸ªåŒ…å«æ•°ä¸‡æ¡è¿åŠ¨åŸè¯­ï¼ˆMotion Primitivesï¼‰çš„è¯è¡¨ã€‚
3. **Probabilistic Head**: é¢„æµ‹å½“å‰åœºæ™¯ä¸‹ï¼Œè¯è¡¨ä¸­æ¯ä¸€æ¡è½¨è¿¹è¢«é€‰ä¸­çš„æ¦‚ç‡åˆ†å¸ƒã€‚
4. **Planning-as-Generation**: é€šè¿‡é‡‡æ ·æˆ– Top-K é€‰æ‹©æ¦‚ç‡æœ€é«˜çš„è½¨è¿¹ä½œä¸ºæœ€ç»ˆè¾“å‡ºã€‚

---

## 3. ğŸ’¡ æ ¸å¿ƒåˆ›æ–° (Math & Pseudo-code)

### 3.1 æ¦‚ç‡è§„åˆ’ (Probabilistic Planning)
**æ•°å­¦é€»è¾‘**ï¼šä½¿ç”¨ **KL æ•£åº¦ (KL Divergence)** å¯¹é½é¢„æµ‹åˆ†å¸ƒä¸ä¸“å®¶æ¼”ç¤ºã€‚

**PyTorch é£æ ¼ä¼ªä»£ç å®ç°**ï¼š
```python
def forward_vadv2(scene_tokens):
    # 1. åœºæ™¯å…¨å±€æ¨ç†
    scene_embed = self.transformer(scene_tokens)
    
    # 2. é¢„æµ‹åŠ¨ä½œæ¦‚ç‡åˆ†å¸ƒ (Action Logits)
    # action_vocab_size: æ¯”å¦‚ 40,000 æ¡é¢„è®¾è½¨è¿¹
    action_logits = self.prob_head(scene_embed) # [B, action_vocab_size]
    
    # 3. è®­ç»ƒé˜¶æ®µï¼šå¯¹é½ä¸“å®¶åˆ†å¸ƒ (KL Loss)
    # target_distribution: åŸºäºä¸“å®¶çœŸå®è¡Œé©¶è½¨è¿¹ç”Ÿæˆçš„é«˜æ–¯åˆ†å¸ƒ
    loss_kl = F.kl_div(action_logits.log_softmax(dim=-1), target_distribution)
    
    # 4. æ¨ç†é˜¶æ®µï¼šé€‰å–æ¦‚ç‡æœ€å¤§è½¨è¿¹
    best_action_idx = torch.argmax(action_logits, dim=-1)
    planned_traj = self.lookup_vocab(best_action_idx)
    
    return planned_traj
```

---

## 5. ğŸ“Š å…³é”®æŒ‡æ ‡
- **Driving Score**: åœ¨é•¿å°¾ã€é«˜åšå¼ˆåœºæ™¯ä¸‹çš„æˆåŠŸç‡ç›¸æ¯” VAD v1 æå‡äº† **25%**ã€‚
- **ä¸€è‡´æ€§**: å½»åº•æ¶ˆé™¤äº†å›å½’æ¨¡å‹åœ¨å¤æ‚è·¯å£çš„â€œè½¨è¿¹æ¼‚ç§»â€ç°è±¡ã€‚

---

## 10. ğŸ› ï¸ è½åœ°å»ºè®®
- **è¯è¡¨å‹ç¼©**: 4 ä¸‡æ¡è½¨è¿¹çš„è¯è¡¨è¿‡å¤§ï¼Œå»ºè®®æ ¹æ®è‡ªè½¦åŠ¨åŠ›å­¦çº¦æŸå®æ—¶å‰ªæï¼Œç¼©å°æœç´¢ç©ºé—´ã€‚
- **ç®—å­æé€Ÿ**: æ¦‚ç‡å¤´çš„ `Softmax` å’Œ `Top-K` å»ºè®®ä½¿ç”¨ä¸“é—¨çš„ç¡¬ä»¶åŠ é€ŸæŒ‡ä»¤ã€‚
