---
date: 2026-02-27
keywords: [SparseAD, Sparse End-to-End, Instance-centric Planning, Horizon Robotics, 2024]
tags: [Level-03, Perception-to-Planning, Efficiency-SOTA]
---

# SparseAD-è®ºæ–‡é€Ÿè¯»

## 0. åŸºæœ¬ä¿¡æ¯
- **å‘è¡¨æ—¶é—´**: 2024å¹´
- **ä½œè€…å•ä½**: åœ°å¹³çº¿ (Horizon Robotics)
- **ä»£ç ä»“åº“**: [https://github.com/HorizonRobotics/SparseAD](https://github.com/HorizonRobotics/SparseAD)
- **Tags**: #ç¨€ç–ç«¯åˆ°ç«¯ #å…¨æµç¨‹Queryé©±åŠ¨ #æä½åŠŸè€—è§„æ§ #2024SOTA

---

## 1. ğŸ”ª ä»Šæ—¥é”è¯„
> **SparseAD** å®£å‘Šäº†â€œBEV ç‰¹å¾å›¾æ—¶ä»£â€åœ¨ç«¯åˆ°ç«¯é¢†åŸŸçš„ç»ˆç»“ã€‚
> 
> **æ ¸å¿ƒæ´å¯Ÿ**ï¼šå¦‚æœæ„ŸçŸ¥å·²ç»å¯ä»¥ç¨€ç–åŒ–ï¼ˆå¦‚ Sparse4Dï¼‰ï¼Œé‚£ä¹ˆè§„æ§ä¸ºä»€ä¹ˆè¿˜è¦çœ‹æ•´å¼  BEV å›¾ï¼ŸSparseAD å®ç°äº†**å…¨æµç¨‹ã€çº¯ Query é©±åŠ¨**çš„ç«¯åˆ°ç«¯ã€‚å®ƒä¸ä»…æ„ŸçŸ¥æ˜¯ç¨€ç–çš„ï¼Œè¿é¢„æµ‹å’Œè§„åˆ’éƒ½æ˜¯åŸºäº Instance Query è¿›è¡Œçš„ã€‚è¿™ä¸ä»…æ˜¯ç®—æ³•çš„èƒœåˆ©ï¼Œæ›´æ˜¯åµŒå…¥å¼éƒ¨ç½²çš„èƒœåˆ©â€”â€”å®ƒè®©ç«¯åˆ°ç«¯ AD çœŸæ­£èƒ½å¤Ÿè·‘åœ¨ä½åŠŸè€—èŠ¯ç‰‡ä¸Šã€‚

---

## 2. ğŸ—ï¸ æ¨¡å‹æ¶æ„ (Architecture Map)
```mermaid
graph TD
    A[Image Inputs] --> B[Sparse Encoder]
    B --> C[Unified Sparse Queries]
    C --> D1[Detection/Tracking Head]
    C --> D2[Online Mapping Head]
    C --> D3[Motion Prediction Head]
    D1 & D2 & D3 --> E[Instance-Centric Planning Head]
    E --> F[Optimal Trajectory Selection]
```

### **è¯¦ç»†æ–‡å­—æè¿°ï¼š**
1. **Unified Sparse Perception**: ä¸€ä¸ªå•ä¸€çš„ç¨€ç–æ¶æ„åŒæ—¶å¤„ç†æ£€æµ‹ã€è·Ÿè¸ªå’Œå»ºå›¾ã€‚
2. **Multi-modal Motion Prediction**: ä¸º ego-vehicle å’Œæ‰€æœ‰éšœç¢ç‰©åŒæ—¶é¢„æµ‹å¤šç§å¯èƒ½çš„æœªæ¥è·¯å¾„ã€‚
3. **Reasonable Planner (æ ¸å¿ƒ)**: 
   - äº§ç”Ÿå¤šä¸ª ego åˆå§‹è·¯å¾„å€™é€‰ã€‚
   - ä½¿ç”¨å¤šç»´çº¦æŸï¼ˆå®‰å…¨ã€èˆ’é€‚ã€è§„åˆ™ï¼‰å¯¹å€™é€‰è·¯å¾„è¿›è¡Œè¯„åˆ†ç­›é€‰ã€‚

---

## 3. ğŸ’¡ æ ¸å¿ƒåˆ›æ–° (Math & Pseudo-code)

### 3.1 ç¨€ç–è§„æ§è¯„åˆ† (Sparse Constraint Evaluation)
**é€»è¾‘**ï¼šåœ¨ Query ç©ºé—´ç›´æ¥è®¡ç®—è§„æ§æŸå¤±ï¼Œæ— éœ€è¿˜åŸå›å¯†é›† Gridã€‚

**PyTorch é£æ ¼ä¼ªä»£ç å®ç°**ï¼š
```python
def sparse_planner_forward(ego_queries, instance_queries, map_queries):
    # 1. è½¨è¿¹å€™é€‰ç”Ÿæˆ
    ego_traj_candidates = self.traj_generator(ego_queries) # [K, T, 2]
    
    # 2. äº¤äº’å†²çªè¯„ä¼° (åœ¨ Query ç©ºé—´å®Œæˆ)
    # åˆ©ç”¨ cross-attention è¯„ä¼° ego è½¨è¿¹ä¸å‘¨å›´éšœç¢ç‰© Query çš„é‡å é£é™©
    collision_scores = self.collision_net(ego_traj_candidates, instance_queries)
    
    # 3. é“è·¯åˆè§„æ€§è¯„ä¼°
    # è¯„ä¼° ego è½¨è¿¹ä¸åœ¨çº¿å»ºå›¾äº§ç”Ÿçš„ Map Query çš„å¯¹é½åº¦
    lane_keep_scores = self.lane_alignment_net(ego_traj_candidates, map_queries)
    
    # 4. æœ€ç»ˆè·¯å¾„é€‰æ‹© (Score-based Selection)
    final_scores = w1 * collision_scores + w2 * lane_keep_scores
    best_traj = ego_traj_candidates[torch.argmax(final_scores)]
    
    return best_traj
```

---

## 5. ğŸ“Š å…³é”®æŒ‡æ ‡ (nuScenes)
- **NDS/mAP**: è¾¾åˆ°ä¸ä¸“ä¸šæ„ŸçŸ¥æ¨¡å‹æŒå¹³çš„æ°´å¹³ã€‚
- **Planning Efficiency**: è§„æ§æ¨¡å—çš„é¢å¤–å»¶è¿Ÿå°äº **2ms**ã€‚
- **Memory**: ç›¸æ¯” UniAD èŠ‚çœäº† **85%** çš„æ˜¾å­˜å¸¦å®½ã€‚

---

## 10. ğŸ› ï¸ è½åœ°å»ºè®®
- **ç®—å­å‹å¥½**: å®Œç¾é€‚é…åœ°å¹³çº¿ **BPU** æ¶æ„ï¼Œå»ºè®®å°† Query äº¤äº’éƒ¨åˆ†ç¼–è¯‘ä¸ºé«˜ä¼˜å…ˆçº§ DLA ä»»åŠ¡ã€‚
- **ä¸‹æ¸¸å¯¹æ¥**: å…¶è¾“å‡ºçš„çŸ¢é‡åŒ–è·¯å¾„å¯ç›´æ¥å–‚ç»™è½¦æ§ç³»ç»Ÿçš„è½¨è¿¹è·Ÿè¸ªç®—æ³•ã€‚
